# Reflection â€”â€” åå°„

## <font color="pink" face="æ±‰ä»ªè¿ªå‡è‹±é›„ä½“, æ¥·ä½“">ä¸€æ—¶åå°„ä¸€æ—¶çˆ½ï¼Œä¸€ç›´åå°„ä¸€ç›´çˆ½</font>

### è·å–å±æ€§ä¿¡æ¯

```csharp
 Type compareInfoType = typeof(CompareItem);
 PropertyInfo[] properties = compareInfoType.GetProperties();
```

éšåå¯é€šè¿‡`properties[i].Name`è·å–å±æ€§åï¼Œ`properties[i].GetValue(obj)`è·å–å±æ€§å€¼ï¼ˆå…¶ä¸­`obj`ï¼‰æ˜¯å…·ä½“çš„å®ä¾‹

### åˆ›å»ºå¯¹è±¡

é€šè¿‡åå°„åˆ›å»ºå¯¹è±¡ï¼Œéœ€è¦è·å–æ„é€ å‡½æ•°ä¿¡æ¯ï¼Œå¹¶è°ƒç”¨æ„é€ å‡½æ•°çš„`Invoke`æ–¹æ³•ï¼Œä¼ å…¥å‚æ•°ï¼Œå³å¯åˆ›å»ºå¯¹è±¡

ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`CreateInstance`æ–¹æ³•è¦é€šè¿‡`dataRow`ä¸­çš„æ•°æ®ï¼Œä½¿ç”¨åå°„åˆ›å»º`T`ç±»å‹çš„å¯¹è±¡

```csharp
 public static T CreateInstance<T>(DataRow dataRow)
 {
     Type type = typeof(T);
     ConstructorInfo constructorInfo = type.GetConstructor(new Type[] { });
     if(constructorInfo != null)
     {
         //è°ƒç”¨ç±»çš„æ— å‚æ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡
         T instance = (T)constructorInfo.Invoke(new object[] { });
         PropertyInfo[] properties = type.GetProperties();
         foreach(PropertyInfo property in properties)
         {
             if (dataRow.Table.Columns.Contains(property.Name) 
                 && dataRow.Table.Columns[property.Name].DataType == property.PropertyType)
             {
                 property.SetValue(instance, dataRow[property.Name]);
             }
         }
         return instance;
     }
     return default(T);
 }
```

å¦‚æœæ˜¯æœ‰å‚æ„é€ å‡½æ•°ï¼Œåˆ™å°†`type.GetConstructor(new Type[] { })`ä¸­çš„å‚æ•°ç±»å‹æ¢æˆæ„é€ å‡½æ•°çš„å‚æ•°ç±»å‹å³å¯
å¦‚ï¼š

```csharp
public class ExampleClass
{
    public int Id { get; set; }
    public string Name { get; set; }

    // æœ‰å‚æ„é€ å‡½æ•°
    public ExampleClass(int id, string name)
    {
        Id = id;
        Name = name;
    }
}
```

å¯é€šè¿‡ä»¥ä¸‹ä»£ç è·å–æœ‰å‚æ„é€ å‡½æ•°ä¿¡æ¯

```csharp
ConstructorInfo constructorInfo = type.GetConstructor(new Type[] { typeof(int), typeof(string) });
```

**å¦‚æœæƒ³è¦è°ƒç”¨æœ‰å‚ä½†æœ‰é»˜è®¤å€¼çš„æ„é€ æ–¹æ³•æ—¶ï¼Œå¯ä»¥ä½¿ç”¨`Type.Missing`åœ¨`Invoke`æ—¶å ä½**

```csharp
public class MyClass
{
    // å¸¦æœ‰é»˜è®¤å‚æ•°çš„æ„é€ æ–¹æ³•
    public MyClass(int requiredParam, string optionalParam = "default", bool flag = true)
    {
        Console.WriteLine($"æ„é€ æ–¹æ³•è¢«è°ƒç”¨: requiredParam={requiredParam}, optionalParam={optionalParam}, flag={flag}");
    }
}

public class Program
{
    public static void Main()
    {
        // è·å–ç±»å‹ä¿¡æ¯
        Type type = typeof(MyClass);

        // å®šä¹‰å‚æ•°ç±»å‹æ•°ç»„ï¼ˆåŒ…å«é»˜è®¤å‚æ•°ï¼‰
        Type[] paramTypes = new Type[] { typeof(int), typeof(string), typeof(bool) };

        // è·å–æ„é€ å‡½æ•°ä¿¡æ¯
        ConstructorInfo constructor = type.GetConstructor(
            BindingFlags.Public | BindingFlags.Instance,
            binder: null,
            types: paramTypes,
            modifiers: null
        );

        if (constructor != null)
        {
            // è°ƒç”¨æ„é€ å‡½æ•°ï¼Œä½¿ç”¨ Type.Missing è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼+++++++
            object instance = constructor.Invoke(new object[] { 42, Type.Missing, Type.Missing });
            Console.WriteLine("å¯¹è±¡åˆ›å»ºæˆåŠŸï¼");
        }
        else
        {
            Console.WriteLine("æœªæ‰¾åˆ°åŒ¹é…çš„æ„é€ å‡½æ•°ï¼");
        }
    }
```

### åå°„è®¿é—®ç§æœ‰å­—æ®µ
è™½ç„¶è¯´ç§æœ‰å˜é‡ä¸èƒ½ç›´æ¥è®¿é—®ï¼Œä½†æ˜¯é€šè¿‡åå°„ï¼Œå¯ä»¥è®¿é—®ç§æœ‰å±æ€§

```csharp
//ç¤ºä¾‹ç±»
public class MyClass
{
    public int PublicField;
    private int PrivateField;
    public static int PublicStaticField;
    private static int PrivateStaticField;
}
```
é€šè¿‡åå°„è®¿é—®ç§æœ‰å­—æ®µï¼Œè¦æŒ‡å®šæœç´¢æ¡ä»¶`BindingFlags.NonPublic`ï¼Œå¦‚æœä¸æŒ‡å®š`BindingFlags.Instance`çš„è¯ï¼Œåªä¼šæ£€ç´¢ç§æœ‰çš„é™æ€å­—æ®µ
å¦‚ï¼š

```csharp
    // è·å–æ‰€æœ‰éå…¬æœ‰å­—æ®µï¼ˆä¸åŒ…æ‹¬å®ä¾‹å­—æ®µï¼‰
    FieldInfo[] nonPublicFields = myType.GetFields(BindingFlags.NonPublic);
```

```csharp
    //æ•ˆæœå’Œä¸Šé¢ä¸€æ ·
    FieldInfo[] nonPublicFields = myType.GetFields(BindingFlags.NonPublic| BindingFlags.Static);
```

ç»“æœï¼š

```csharp
éå…¬æœ‰å­—æ®µï¼š
PrivateStaticField
```

å¦‚æœè¦åŒæ—¶è·å–å®ä¾‹å­—æ®µï¼Œåˆ™è¦æŒ‡å®š`BindingFlags.Instance`

```csharp
    FieldInfo[] nonPublicFields = myType.GetFields(BindingFlags.NonPublic| BindingFlags.Static|BindingFlags.Instance);
```

è€Œå¦‚æœä¸æŒ‡å®šæœç´¢æ¡ä»¶çš„è¯ï¼Œåˆ™ä¼šåŒæ—¶æ£€ç´¢åˆ°å…¬æœ‰çš„å®ä¾‹å’Œé™æ€å­—æ®µ,<font color="purple">ç§æœ‰çš„ä¸ä¼šè¢«æ£€ç´¢å‡ºæ¥</font>

### <font color="red" face="æ¥·ä½“">è‡³äºå…¶ä»–å…³äºæ–¹æ³•çš„åå°„ï¼Œç­‰ç”¨åˆ°çš„æ—¶å€™å†è®°å½•</font> ğŸ‘½

